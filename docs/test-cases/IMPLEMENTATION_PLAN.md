# 📋 통합 테스트 구현 계획 (06-09)

## 🎯 전체 개요
- **목표**: 06번부터 09번까지의 통합 테스트 문서 재작성 및 테스트 코드 구현
- **기준**: 01-basic-regular-cycle.md 구조를 따름
- **진행 방식**: 순차적 진행 (하나 완료 후 다음 진행)

## 📊 구현 범위
| 번호 | 파일명 | 테스트 케이스 | 상태 |
|------|--------|--------------|------|
| 06 | with-ovulation-test | 12개 | 진행중 |
| 07 | with-manual-ovulation | 12개 | 대기 |
| 08 | edge-cases | 10개 | 대기 |
| 09 | complex-scenarios | 11개 | 대기 |

## 🔴 핵심 규칙: 배란 데이터 처리

### 배란일 표시 규칙
```
1. 사용자 입력 데이터는 모두 표시:
   - 배란 테스트 양성 날짜 ✅
   - 수동 입력 날짜 ✅
   - 같은 날 중복시 → 한 번만 표시
   - 다른 날 → 모두 표시

2. 계산된 배란일:
   - 사용자 입력이 없을 때만 표시
   - 사용자 입력이 있으면 → 계산값은 무시

3. 특수 상황:
   - 임신 중 → 배란 계산 안함 (입력은 표시)
   - 피임약 중 → 배란 계산 안함 (입력은 표시)
```

### 복합 시나리오 예시
```
1월 14일: 배란 테스트 양성
1월 15일: 수동 입력
1월 16일: 테스트 양성 + 수동 입력 (같은 날)

결과:
- 배란일: 1월 14일, 15일, 16일 (3일 모두 표시)
- 가임기: 각 배란일 -2 ~ +1일 병합
```

---

## 📁 06-with-ovulation-test

### 개요
- **목적**: 배란 테스트 기록이 있을 때의 주기 계산 검증
- **핵심**: 배란 테스트 양성 결과가 기본 계산을 override

### 테스트 구성 (12개)
#### 그룹 1: 기본 케이스 (TC-06-01~03)
- TC-06-01: 단일 배란 테스트 양성
- TC-06-02: 연속 2일 양성 (LH surge)
- TC-06-03: 월별 양성 패턴

#### 그룹 2: 예측과 비교 (TC-06-04~06)
- TC-06-04: 예측보다 빠른 배란 (day 10)
- TC-06-05: 예측과 일치 (day 14)
- TC-06-06: 예측보다 늦은 배란 (day 18)

#### 그룹 3: 복수 주기 (TC-06-07~09)
- TC-06-07: 2개월 연속 데이터
- TC-06-08: 3개월 패턴 분석
- TC-06-09: 불규칙 양성 결과

#### 그룹 4: 특수 케이스 (TC-06-10~12)
- TC-06-10: 생리 중 양성 (예외)
- TC-06-11: 짧은 주기에서 양성 (24일)
- TC-06-12: 긴 주기에서 양성 (35일)

### 공통 입력 데이터
```kotlin
생리 기록:
- Period 1: 2025-01-01 ~ 2025-01-05
- Period 2: 2025-01-29 ~ 2025-02-02
- Period 3: 2025-02-26 ~ 2025-03-02

배란 테스트: (테스트별 다름)
오늘: 2025-03-15
주기 설정: 28일/5일
```

---

## 📁 07-with-manual-ovulation

### 개요
- **목적**: 사용자 수동 입력 배란일 처리 검증
- **핵심**: 수동 입력과 테스트 결과 병합 표시

### 테스트 구성 (12개)
#### 그룹 1: 기본 케이스 (TC-07-01~03)
- TC-07-01: 단일 수동 입력
- TC-07-02: 월별 수동 입력
- TC-07-03: 다중 수동 입력

#### 그룹 2: 복합 배란 데이터 (TC-07-04~07)
- TC-07-04: 수동입력만 있을 때
- TC-07-05: 테스트 양성만 있을 때
- TC-07-06: 같은 날 둘 다 (중복 제거)
- TC-07-07: 다른 날 각각 (모두 표시)

#### 그룹 3: 혼합 패턴 (TC-07-08~10)
- TC-07-08: 1일 테스트, 2일 수동
- TC-07-09: 1일 수동, 2일 테스트
- TC-07-10: 1일 둘다, 2일 수동, 3일 테스트

#### 그룹 4: 엣지 케이스 (TC-07-11~12)
- TC-07-11: 생리일과 겹침
- TC-07-12: 매우 이른/늦은 배란

### 핵심 검증
```kotlin
// 배란 데이터 병합
val allOvulationDays = combineOvulationDates(
    ovulationTests,      // 테스트기 양성
    userOvulationDays    // 수동 입력
)
// 중복 제거 후 모든 날짜 표시
```

---

## 📁 08-edge-cases

### 개요
- **목적**: 극단적이거나 특수한 상황 처리 검증
- **핵심**: 경계값 및 예외 상황

### 테스트 구성 (10개)
#### 그룹 1: 생리 지연 (TC-08-01~03)
- TC-08-01: 1-7일 지연
- TC-08-02: 8-14일 지연
- TC-08-03: 15일 이상 지연

#### 그룹 2: 극단적 주기 (TC-08-04~06)
- TC-08-04: 21일 미만 초단기
- TC-08-05: 21-25일 짧은 주기
- TC-08-06: 40일 이상 긴 주기

#### 그룹 3: 불규칙 패턴 (TC-08-07~08)
- TC-08-07: 주기 변동폭 큼
- TC-08-08: 생리 기간 변동

#### 그룹 4: 데이터 부족 (TC-08-09~10)
- TC-08-09: 1개 기록만 있음
- TC-08-10: 6개월 이상 공백

### 특수 계산 공식
```kotlin
// 짧은 주기 (<26일)
ovulationDay = lastPeriodStart + cycle - 17

// 긴 주기 (>32일)
ovulationDay = lastPeriodStart + cycle - 14

// 정상 주기 (26-32일)
ovulationDay = lastPeriodStart + cycle - 14
```

---

## 📁 09-complex-scenarios

### 개요
- **목적**: 실제 사용 환경의 복잡한 시나리오 검증
- **핵심**: 다양한 데이터 조합 및 우선순위

### 테스트 구성 (11개)
#### 그룹 1: 복합 데이터 (TC-09-01~04)
- TC-09-01: 피임약 + 배란데이터
- TC-09-02: 수동 + 테스트 + 계산
- TC-09-03: 임신 + 배란데이터
- TC-09-04: 월별 다른 조합

#### 그룹 2: 장기간 조회 (TC-09-05~07)
- TC-09-05: 1년 조회
- TC-09-06: 2년 조회
- TC-09-07: 전체 기록 조회

#### 그룹 3: 특수 상황 (TC-09-08~09)
- TC-09-08: 시간대 변경
- TC-09-09: 윤년 처리

#### 그룹 4: 성능 테스트 (TC-09-10~11)
- TC-09-10: 대용량 데이터 (1000+ 기록)
- TC-09-11: 복잡한 계산 (모든 기능 동시)

---

## ✅ 공통 체크리스트

### 문서 작성 시
- [ ] 01번과 동일한 구조 사용
- [ ] 제목: `# [한글 제목]`
- [ ] 공통 입력: `## 📌 공통 입력 조건`
- [ ] 테스트 케이스: `### TC-XX-XX: [이름]`
- [ ] 하위 섹션: 📌 테스트 목적, 📝 입력 조건, ✅ 예상 결과, 🔍 검증 포인트
- [ ] 구분선: `---` 사용
- [ ] 날짜: 2025년 통일

### 테스트 구현 시
- [ ] WithPillTest.kt 패턴 참고
- [ ] Companion object로 상수 정의
- [ ] setupCommonData() 헬퍼 함수
- [ ] JavaDoc 주석 추가
- [ ] TC 번호로 메소드명
- [ ] 명확한 assertion 메시지

### 검증
- [ ] 컴파일 에러 확인
- [ ] 개별 테스트 실행
- [ ] 전체 테스트 영향 확인
- [ ] 커버리지 측정

---

## 📅 진행 현황

### 완료
- [x] 01-05번: 기본 테스트 완료
- [x] WithPillTest: 피임약 테스트 완료
- [x] PregnancyIntegrationTest: 임신 테스트 완료

### 진행중
- [ ] 06-with-ovulation-test

### 대기중
- [ ] 07-with-manual-ovulation
- [ ] 08-edge-cases
- [ ] 09-complex-scenarios

---

## 🔍 참고사항

### 날짜 처리
- LocalDate 사용 (kotlinx.datetime)
- Julian Day 변환: `DateUtils.toJulianDay()`
- 2025년 날짜로 통일

### Repository 메소드
```kotlin
repository.addPeriod(PeriodRecord(...))
repository.addOvulationTest(OvulationTest(...))
repository.addUserOvulationDay(OvulationDay(...))
repository.setPeriodSettings(PeriodSettings(...))
repository.setPillSettings(PillSettings(...))
```

### 주요 Enum
```kotlin
TestResult.POSITIVE  // 배란 테스트 양성
TestResult.NEGATIVE  // 배란 테스트 음성
DayType.OVULATION    // 배란기
DayType.FERTILE      // 가임기
```

---

이 계획서를 기반으로 각 테스트를 순차적으로 구현합니다.